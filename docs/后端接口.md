```yml
openapi: 3.0.3
info:
  title: APS Scheduling System API
  version: 1.0.0
  description: >
    汽车制造 APS 排产系统（四大工艺，按辆/班）REST API。
    BaseURL: /api/v1

servers:
  - url: /api/v1

tags:
  - name: Auth
  - name: Users
  - name: Dict
  - name: Config
  - name: MasterData-Model
  - name: MasterData-Item
  - name: MasterData-BOM
  - name: MasterData-Route
  - name: MasterData-Resource
  - name: Calendar
  - name: SalesOrder
  - name: ProdOrder
  - name: Approve
  - name: Plan-MPS
  - name: Plan-MRP
  - name: Schedule
  - name: WorkOrder
  - name: Exception
  - name: VIN-Trace
  - name: Reports
  - name: OpenAPI

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

    accessKeyAuth:
      type: apiKey
      in: header
      name: X-Access-Key
    signatureAuth:
      type: apiKey
      in: header
      name: X-Signature
    timestampAuth:
      type: apiKey
      in: header
      name: X-Timestamp
    nonceAuth:
      type: apiKey
      in: header
      name: X-Nonce

  headers:
    XTraceId:
      description: Trace id for request tracking
      schema:
        type: string
    IdempotencyKey:
      description: Idempotency key for write operations
      schema:
        type: string

  parameters:
    PageNo:
      name: pageNo
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
    PageSize:
      name: pageSize
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 200
        default: 20
    Keyword:
      name: keyword
      in: query
      required: false
      schema:
        type: string
    Status:
      name: status
      in: query
      required: false
      schema:
        type: integer
    IdPath:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
    FromDate:
      name: fromDate
      in: query
      required: true
      schema:
        type: string
        format: date
    ToDate:
      name: toDate
      in: query
      required: true
      schema:
        type: string
        format: date

  responses:
    ApiResponseOK:
      description: OK
      headers:
        X-Trace-Id:
          $ref: '#/components/headers/XTraceId'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
    ApiResponseError:
      description: Error
      headers:
        X-Trace-Id:
          $ref: '#/components/headers/XTraceId'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'

  schemas:
    ApiResponse:
      type: object
      required: [code, message, data, timestamp]
      properties:
        code:
          type: integer
          description: 0=success, others=error
        message:
          type: string
        data:
          nullable: true
        traceId:
          type: string
        timestamp:
          type: integer
          format: int64

    PageResult:
      type: object
      required: [list, pageNo, pageSize, total]
      properties:
        list:
          type: array
          items: {}
        pageNo:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
          format: int64

    IdName:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string

    # ---------- Common DTO ----------
    UserDTO:
      type: object
      properties:
        id: { type: integer, format: int64 }
        username: { type: string }
        role: { type: string, enum: [admin, user] }
        realName: { type: string }
        mobile: { type: string }
        email: { type: string }
        status: { type: integer }
        lastLoginTime: { type: string, format: date-time }

    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username: { type: string }
        password: { type: string }

    LoginResponse:
      type: object
      properties:
        token: { type: string }
        expiresIn: { type: integer }
        role: { type: string }
        userId: { type: integer, format: int64 }

    DictTypeDTO:
      type: object
      properties:
        id: { type: integer, format: int64 }
        typeCode: { type: string }
        typeName: { type: string }
        status: { type: integer }
        remark: { type: string }

    DictItemDTO:
      type: object
      properties:
        id: { type: integer, format: int64 }
        typeId: { type: integer, format: int64 }
        itemKey: { type: string }
        itemValue: { type: string }
        sortNo: { type: integer }
        status: { type: integer }
        remark: { type: string }

    # ---------- Master Data ----------
    ModelCreate:
      type: object
      required: [modelCode, modelName]
      properties:
        modelCode: { type: string }
        modelName: { type: string }
        platform: { type: string }
        status: { type: integer, default: 1 }
        remark: { type: string }

    ModelDTO:
      allOf:
        - $ref: '#/components/schemas/ModelCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    ItemCreate:
      type: object
      required: [itemCode, itemName, itemType]
      properties:
        itemCode: { type: string }
        itemName: { type: string }
        itemType: { type: integer, description: "1原料2半成品3成品4辅料" }
        uom: { type: string }
        spec: { type: string }
        status: { type: integer, default: 1 }
        remark: { type: string }

    ItemDTO:
      allOf:
        - $ref: '#/components/schemas/ItemCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    BomCreate:
      type: object
      required: [bomCode, modelId, version, effectiveFrom]
      properties:
        bomCode: { type: string }
        modelId: { type: integer, format: int64 }
        version: { type: string }
        effectiveFrom: { type: string, format: date-time }
        effectiveTo: { type: string, format: date-time, nullable: true }
        status: { type: integer, default: 1 }
        remark: { type: string }

    BomItemDTO:
      type: object
      properties:
        id: { type: integer, format: int64 }
        parentItemCode: { type: string, nullable: true }
        itemCode: { type: string }
        qty: { type: number, format: double }
        lossRate: { type: number, format: double }
        levelNo: { type: integer }
        isOptional: { type: integer, description: "0/1" }
        optionGroup: { type: string, nullable: true }
        altGroup: { type: string, nullable: true }
        remark: { type: string, nullable: true }

    BomDTO:
      allOf:
        - $ref: '#/components/schemas/BomCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }
            items:
              type: array
              items:
                $ref: '#/components/schemas/BomItemDTO'

    BomImportRequest:
      type: object
      required: [mode, items]
      properties:
        mode:
          type: string
          enum: [REPLACE, APPEND]
        items:
          type: array
          items:
            $ref: '#/components/schemas/BomItemDTO'

    RouteCreate:
      type: object
      required: [modelId, processType, version]
      properties:
        routeCode: { type: string, nullable: true }
        modelId: { type: integer, format: int64 }
        processType: { type: integer, description: "1冲压2焊装3涂装4总装" }
        version: { type: string }
        status: { type: integer, default: 1 }
        remark: { type: string }

    OperationCreate:
      type: object
      required: [opCode, opName, seqNo]
      properties:
        opCode: { type: string }
        opName: { type: string }
        seqNo: { type: integer }
        stdMinutesPerUnit: { type: integer, default: 0 }
        setupMinutes: { type: integer, default: 0 }
        stationGroup: { type: string, nullable: true }
        constraintJson: { type: object, nullable: true }
        status: { type: integer, default: 1 }
        remark: { type: string, nullable: true }

    OperationDTO:
      allOf:
        - $ref: '#/components/schemas/OperationCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    RouteDTO:
      allOf:
        - $ref: '#/components/schemas/RouteCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }
            operations:
              type: array
              items:
                $ref: '#/components/schemas/OperationDTO'

    # ---------- Resource DTO ----------
    WorkshopCreate:
      type: object
      required: [workshopCode, workshopName]
      properties:
        workshopCode: { type: string }
        workshopName: { type: string }
        processType: { type: integer, nullable: true }
        status: { type: integer, default: 1 }
        remark: { type: string }

    WorkshopDTO:
      allOf:
        - $ref: '#/components/schemas/WorkshopCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    LineCreate:
      type: object
      required: [workshopId, lineCode, lineName, processType]
      properties:
        workshopId: { type: integer, format: int64 }
        lineCode: { type: string }
        lineName: { type: string }
        processType: { type: integer }
        status: { type: integer, default: 1 }
        remark: { type: string }

    LineDTO:
      allOf:
        - $ref: '#/components/schemas/LineCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    StationCreate:
      type: object
      required: [lineId, stationCode, stationName]
      properties:
        lineId: { type: integer, format: int64 }
        stationCode: { type: string }
        stationName: { type: string }
        capacityQtyPerShift: { type: integer, default: 0 }
        status: { type: integer, default: 1 }
        remark: { type: string }

    StationDTO:
      allOf:
        - $ref: '#/components/schemas/StationCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    EquipmentCreate:
      type: object
      required: [stationId, equipCode, equipName]
      properties:
        stationId: { type: integer, format: int64 }
        equipCode: { type: string }
        equipName: { type: string }
        status: { type: integer, default: 1 }
        remark: { type: string }

    EquipmentDTO:
      allOf:
        - $ref: '#/components/schemas/EquipmentCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    ToolingCreate:
      type: object
      required: [toolingCode, toolingName, toolingType]
      properties:
        toolingCode: { type: string }
        toolingName: { type: string }
        toolingType: { type: integer, description: "1模具2夹具3检具" }
        status: { type: integer, default: 1 }
        remark: { type: string }

    ToolingDTO:
      allOf:
        - $ref: '#/components/schemas/ToolingCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    StationGroupCreate:
      type: object
      required: [groupCode, groupName]
      properties:
        groupCode: { type: string }
        groupName: { type: string }
        status: { type: integer, default: 1 }
        remark: { type: string }

    StationGroupDTO:
      allOf:
        - $ref: '#/components/schemas/StationGroupCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    LaborGroupCreate:
      type: object
      required: [laborCode, laborName]
      properties:
        laborCode: { type: string }
        laborName: { type: string }
        headcount: { type: integer, default: 0 }
        status: { type: integer, default: 1 }
        remark: { type: string }

    LaborGroupDTO:
      allOf:
        - $ref: '#/components/schemas/LaborGroupCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    # ---------- Calendar ----------
    CalendarDayBatchSetRequest:
      type: object
      required: [resourceType, resourceId, fromDate, toDate, isWorkday]
      properties:
        resourceType: { type: integer, description: "1产线2工位3设备4模具5人力组" }
        resourceId: { type: integer, format: int64 }
        fromDate: { type: string, format: date }
        toDate: { type: string, format: date }
        isWorkday: { type: integer, description: "0/1" }
        remark: { type: string, nullable: true }

    CalendarShiftSetRequest:
      type: object
      required: [resourceType, resourceId, bizDate, shifts]
      properties:
        resourceType: { type: integer }
        resourceId: { type: integer, format: int64 }
        bizDate: { type: string, format: date }
        shifts:
          type: array
          items:
            $ref: '#/components/schemas/ShiftDTO'

    ShiftDTO:
      type: object
      required: [shiftCode, startTime, endTime, capacityQty]
      properties:
        shiftCode: { type: string }
        startTime: { type: string, example: "08:00:00" }
        endTime: { type: string, example: "20:00:00" }
        capacityQty: { type: integer, description: "辆/班" }
        status: { type: integer, default: 1 }
        remark: { type: string, nullable: true }

    MaintenanceWindowCreate:
      type: object
      required: [resourceType, resourceId, startTime, endTime]
      properties:
        resourceType: { type: integer }
        resourceId: { type: integer, format: int64 }
        startTime: { type: string, format: date-time }
        endTime: { type: string, format: date-time }
        reason: { type: string, nullable: true }
        status: { type: integer, default: 1 }

    # ---------- Orders ----------
    SalesOrderCreate:
      type: object
      required: [salesNo, modelId, qty, dueDate]
      properties:
        salesNo: { type: string }
        customerCode: { type: string, nullable: true }
        modelId: { type: integer, format: int64 }
        qty: { type: integer }
        dueDate: { type: string, format: date }
        priority: { type: integer, default: 0 }
        status: { type: integer, default: 0 }
        remark: { type: string, nullable: true }
        sourcePayload: { type: object, nullable: true }

    SalesOrderDTO:
      allOf:
        - $ref: '#/components/schemas/SalesOrderCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }

    ProdOrderCreate:
      type: object
      required: [prodNo, orderKind, modelId, bomId, routeVersion, qty, dueDate]
      properties:
        prodNo: { type: string }
        salesId: { type: integer, format: int64, nullable: true }
        orderKind: { type: integer, description: "1常规2紧急3定制4插单5返工" }
        modelId: { type: integer, format: int64 }
        bomId: { type: integer, format: int64 }
        routeVersion: { type: string }
        qty: { type: integer }
        dueDate: { type: string, format: date }
        priority: { type: integer, default: 0 }
        status: { type: integer, default: 0 }
        remark: { type: string, nullable: true }

    ProdOrderDTO:
      allOf:
        - $ref: '#/components/schemas/ProdOrderCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }
            attrs:
              type: array
              items:
                $ref: '#/components/schemas/ProdOrderAttr'

    ProdOrderAttr:
      type: object
      required: [attrKey, attrValue]
      properties:
        attrKey: { type: string, example: "color" }
        attrValue: { type: string, example: "R001" }

    ProdOrderAttrsSetRequest:
      type: object
      required: [attrs]
      properties:
        attrs:
          type: array
          items:
            $ref: '#/components/schemas/ProdOrderAttr'

    ToProdRequest:
      type: object
      required: [orderKind, bomId, routeVersion]
      properties:
        orderKind: { type: integer }
        bomId: { type: integer, format: int64 }
        routeVersion: { type: string }

    CommentRequest:
      type: object
      properties:
        comment: { type: string }

    # ---------- Approve ----------
    ApproveTaskDTO:
      type: object
      properties:
        id: { type: integer, format: int64 }
        objectType: { type: string }
        objectId: { type: integer, format: int64 }
        stepNo: { type: integer }
        stepName: { type: string }
        assigneeRole: { type: string }
        status: { type: integer }
        comment: { type: string, nullable: true }

    # ---------- MPS/MRP ----------
    MpsCreate:
      type: object
      required: [mpsNo, startDate, endDate]
      properties:
        mpsNo: { type: string }
        startDate: { type: string, format: date }
        endDate: { type: string, format: date }
        status: { type: integer, default: 0 }
        remark: { type: string, nullable: true }

    MpsItem:
      type: object
      required: [bizDate, modelId, qty]
      properties:
        bizDate: { type: string, format: date }
        modelId: { type: integer, format: int64 }
        qty: { type: integer }

    MpsDTO:
      allOf:
        - $ref: '#/components/schemas/MpsCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }
            items:
              type: array
              items:
                $ref: '#/components/schemas/MpsItem'

    MrpRunRequest:
      type: object
      required: [mpsId]
      properties:
        mpsId: { type: integer, format: int64 }

    # ---------- Schedule ----------
    ScheduleJobCreate:
      type: object
      required: [horizonStart, horizonEnd, prodOrderIds, processTypes, objective, constraints]
      properties:
        horizonStart: { type: string, format: date }
        horizonEnd: { type: string, format: date }
        prodOrderIds:
          type: array
          items: { type: integer, format: int64 }
        processTypes:
          type: array
          items: { type: integer, description: "1~4" }
        lineScope:
          type: array
          items:
            $ref: '#/components/schemas/LineScope'
          nullable: true
        objective:
          $ref: '#/components/schemas/ScheduleObjective'
        constraints:
          $ref: '#/components/schemas/ScheduleConstraints'

    LineScope:
      type: object
      required: [processType, lineIds]
      properties:
        processType: { type: integer }
        lineIds:
          type: array
          items: { type: integer, format: int64 }

    ScheduleObjective:
      type: object
      required: [dueDateWeight, setupWeight, utilizationWeight]
      properties:
        dueDateWeight: { type: number, format: double }
        setupWeight: { type: number, format: double }
        utilizationWeight: { type: number, format: double }

    ScheduleConstraints:
      type: object
      required: [enableMoldChange, enableColorSwitch, enableMaterialKitCheck, respectMaintenanceWindow]
      properties:
        enableMoldChange: { type: boolean }
        enableColorSwitch: { type: boolean }
        enableMaterialKitCheck: { type: boolean }
        respectMaintenanceWindow: { type: boolean }

    ScheduleJobDTO:
      type: object
      properties:
        jobId: { type: integer, format: int64 }
        jobNo: { type: string }
        status: { type: integer }
        statusText: { type: string }
        plans:
          type: array
          items:
            $ref: '#/components/schemas/SchedulePlanBrief'
        errorMsg: { type: string, nullable: true }

    SchedulePlanBrief:
      type: object
      properties:
        planId: { type: integer, format: int64 }
        planNo: { type: string }
        isBest: { type: integer }
        kpi: { type: object, nullable: true }

    PublishPlanRequest:
      type: object
      properties:
        remark: { type: string, nullable: true }

    VoidPlanRequest:
      type: object
      properties:
        reason: { type: string }

    PlanAdjustRequest:
      type: object
      required: [changes]
      properties:
        changes:
          type: array
          items:
            $ref: '#/components/schemas/PlanAdjustChange'
        recheck:
          type: boolean
          default: true

    PlanAdjustChange:
      type: object
      required: [bucketId]
      properties:
        bucketId: { type: integer, format: int64 }
        toLineId: { type: integer, format: int64, nullable: true }
        toBizDate: { type: string, format: date, nullable: true }
        toShiftCode: { type: string, nullable: true }
        toSeqNo: { type: integer, nullable: true }

    # ---------- WorkOrder ----------
    WorkOrderDTO:
      type: object
      properties:
        id: { type: integer, format: int64 }
        woNo: { type: string }
        planId: { type: integer, format: int64 }
        planBucketId: { type: integer, format: int64 }
        processType: { type: integer }
        prodOrderId: { type: integer, format: int64 }
        lineId: { type: integer, format: int64 }
        bizDate: { type: string, format: date }
        shiftCode: { type: string }
        seqNo: { type: integer }
        qtyPlanned: { type: integer }
        qtyDone: { type: integer }
        status: { type: integer }
        remark: { type: string, nullable: true }

    WorkOrderActionRequest:
      type: object
      properties:
        remark: { type: string, nullable: true }

    WorkOrderReportRequest:
      type: object
      required: [reportTime, qtyGood, qtyBad]
      properties:
        reportTime: { type: string, format: date-time }
        stationId: { type: integer, format: int64, nullable: true }
        qtyGood: { type: integer }
        qtyBad: { type: integer }
        detailJson: { type: object, nullable: true }

    # ---------- Exception ----------
    ExceptionCreate:
      type: object
      required: [woId, type, level, desc]
      properties:
        woId: { type: integer, format: int64 }
        type: { type: string }
        level: { type: integer }
        desc: { type: string }
        payload: { type: object, nullable: true }

    ExceptionDTO:
      allOf:
        - $ref: '#/components/schemas/ExceptionCreate'
        - type: object
          properties:
            id: { type: integer, format: int64 }
            status: { type: integer }

    # ---------- VIN ----------
    VinBatchCreateRequest:
      type: object
      required: [prodOrderId, qty, ruleCode]
      properties:
        prodOrderId: { type: integer, format: int64 }
        qty: { type: integer }
        ruleCode: { type: string }

    VinDTO:
      type: object
      properties:
        vin: { type: string }
        modelId: { type: integer, format: int64 }
        prodOrderId: { type: integer, format: int64 }
        currentWoId: { type: integer, format: int64, nullable: true }
        status: { type: integer }

    VinComponentBindRequest:
      type: object
      required: [partCode, serialNo, bindTime]
      properties:
        partCode: { type: string }
        serialNo: { type: string }
        bindTime: { type: string, format: date-time }
        payload: { type: object, nullable: true }

    # ---------- Reports ----------
    KpiOverviewDTO:
      type: object
      properties:
        planQty: { type: integer }
        doneQty: { type: integer }
        otdRate: { type: number, format: double }
        setupTimes: { type: integer }
        avgLoadRate: { type: number, format: double }

paths:
  # ---------------- Auth ----------------
  /auth/login:
    post:
      tags: [Auth]
      security: []
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponse'

  /auth/me:
    get:
      tags: [Auth]
      summary: Current user
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserDTO'

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout
      responses:
        '200':
          $ref: '#/components/responses/ApiResponseOK'

  # ---------------- Users ----------------
  /users:
    post:
      tags: [Users]
      summary: Create user (admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password, role]
              properties:
                username: { type: string }
                password: { type: string }
                role: { type: string, enum: [admin, user] }
                realName: { type: string }
                mobile: { type: string }
                email: { type: string }
                status: { type: integer, default: 1 }
      responses:
        '200':
          $ref: '#/components/responses/ApiResponseOK'
    get:
      tags: [Users]
      summary: List users
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: role
          in: query
          required: false
          schema: { type: string, enum: [admin, user] }
        - $ref: '#/components/parameters/Status'
        - $ref: '#/components/parameters/Keyword'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        allOf:
                          - $ref: '#/components/schemas/PageResult'
                          - type: object
                            properties:
                              list:
                                type: array
                                items:
                                  $ref: '#/components/schemas/UserDTO'

  /users/{id}:
    patch:
      tags: [Users]
      summary: Update user
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role: { type: string, enum: [admin, user] }
                realName: { type: string }
                mobile: { type: string }
                email: { type: string }
                status: { type: integer }
      responses:
        '200':
          $ref: '#/components/responses/ApiResponseOK'

  /users/{id}/reset-password:
    post:
      tags: [Users]
      summary: Reset password
      parameters:
        - $ref: '#/components/parameters/IdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [newPassword]
              properties:
                newPassword: { type: string }
      responses:
        '200':
          $ref: '#/components/responses/ApiResponseOK'

  # ---------------- Dict/Config ----------------
  /dict/types:
    get:
      tags: [Dict]
      summary: Dict types
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data:
                    type: array
                    items: { $ref: '#/components/schemas/DictTypeDTO' }

  /dict/items:
    get:
      tags: [Dict]
      summary: Dict items by typeCode
      parameters:
        - name: typeCode
          in: query
          required: true
          schema: { type: string }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data:
                    type: array
                    items: { $ref: '#/components/schemas/DictItemDTO' }

  /config:
    get:
      tags: [Config]
      summary: List system config
      responses:
        '200':
          $ref: '#/components/responses/ApiResponseOK'

  /config/{id}:
    patch:
      tags: [Config]
      summary: Update config (admin)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cfgValue: { type: string }
                status: { type: integer }
                remark: { type: string }
      responses:
        '200':
          $ref: '#/components/responses/ApiResponseOK'

  # ---------------- MasterData: Model ----------------
  /md/models:
    post:
      tags: [MasterData-Model]
      summary: Create model
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ModelCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Model]
      summary: List models
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
        - $ref: '#/components/parameters/Status'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data:
                    allOf: [ { $ref: '#/components/schemas/PageResult' } ]
                    properties:
                      list:
                        type: array
                        items: { $ref: '#/components/schemas/ModelDTO' }

  /md/models/{id}:
    get:
      tags: [MasterData-Model]
      summary: Get model
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data: { $ref: '#/components/schemas/ModelDTO' }
    patch:
      tags: [MasterData-Model]
      summary: Update model
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                modelName: { type: string }
                platform: { type: string }
                status: { type: integer }
                remark: { type: string }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    delete:
      tags: [MasterData-Model]
      summary: Delete model (soft)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- MasterData: Item ----------------
  /md/items:
    post:
      tags: [MasterData-Item]
      summary: Create item
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ItemCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Item]
      summary: List items
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
        - name: itemType
          in: query
          required: false
          schema: { type: integer }
        - $ref: '#/components/parameters/Status'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data:
                    allOf: [ { $ref: '#/components/schemas/PageResult' } ]
                    properties:
                      list:
                        type: array
                        items: { $ref: '#/components/schemas/ItemDTO' }

  /md/items/{id}:
    get:
      tags: [MasterData-Item]
      summary: Get item
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data: { $ref: '#/components/schemas/ItemDTO' }
    patch:
      tags: [MasterData-Item]
      summary: Update item
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                itemName: { type: string }
                itemType: { type: integer }
                uom: { type: string }
                spec: { type: string }
                status: { type: integer }
                remark: { type: string }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    delete:
      tags: [MasterData-Item]
      summary: Delete item (soft)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- MasterData: BOM ----------------
  /md/boms:
    post:
      tags: [MasterData-BOM]
      summary: Create BOM
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/BomCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-BOM]
      summary: List BOMs
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: modelId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - name: version
          in: query
          required: false
          schema: { type: string }
        - $ref: '#/components/parameters/Status'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data:
                    allOf: [ { $ref: '#/components/schemas/PageResult' } ]
                    properties:
                      list:
                        type: array
                        items:
                          allOf:
                            - $ref: '#/components/schemas/BomCreate'
                            - type: object
                              properties:
                                id: { type: integer, format: int64 }

  /md/boms/{id}:
    get:
      tags: [MasterData-BOM]
      summary: Get BOM (with items)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data: { $ref: '#/components/schemas/BomDTO' }
    patch:
      tags: [MasterData-BOM]
      summary: Update BOM meta
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                effectiveFrom: { type: string, format: date-time }
                effectiveTo: { type: string, format: date-time, nullable: true }
                status: { type: integer }
                remark: { type: string }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/boms/{id}/items:import:
    post:
      tags: [MasterData-BOM]
      summary: Import BOM items (replace/append)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/BomImportRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- MasterData: Route ----------------
  /md/routes:
    post:
      tags: [MasterData-Route]
      summary: Create route
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RouteCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Route]
      summary: List routes
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: modelId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - name: processType
          in: query
          required: false
          schema: { type: integer }
        - name: version
          in: query
          required: false
          schema: { type: string }
        - $ref: '#/components/parameters/Status'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/routes/{id}:
    get:
      tags: [MasterData-Route]
      summary: Get route (with operations)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data: { $ref: '#/components/schemas/RouteDTO' }
    patch:
      tags: [MasterData-Route]
      summary: Update route
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status: { type: integer }
                remark: { type: string }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/routes/{id}/operations:
    post:
      tags: [MasterData-Route]
      summary: Add operation to route
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/OperationCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/operations/{opId}:
    patch:
      tags: [MasterData-Route]
      summary: Update operation
      parameters:
        - name: opId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/OperationCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- MasterData: Resource ----------------
  /md/workshops:
    post:
      tags: [MasterData-Resource]
      summary: Create workshop
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WorkshopCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Resource]
      summary: List workshops
      parameters: [ { $ref: '#/components/parameters/PageNo' }, { $ref: '#/components/parameters/PageSize' }, { $ref: '#/components/parameters/Keyword' }, { $ref: '#/components/parameters/Status' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/lines:
    post:
      tags: [MasterData-Resource]
      summary: Create line
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LineCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Resource]
      summary: List lines
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: workshopId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - name: processType
          in: query
          required: false
          schema: { type: integer }
        - $ref: '#/components/parameters/Keyword'
        - $ref: '#/components/parameters/Status'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/stations:
    post:
      tags: [MasterData-Resource]
      summary: Create station
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/StationCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Resource]
      summary: List stations
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: lineId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - $ref: '#/components/parameters/Keyword'
        - $ref: '#/components/parameters/Status'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/equipments:
    post:
      tags: [MasterData-Resource]
      summary: Create equipment
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EquipmentCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Resource]
      summary: List equipments
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: stationId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - $ref: '#/components/parameters/Keyword'
        - $ref: '#/components/parameters/Status'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/toolings:
    post:
      tags: [MasterData-Resource]
      summary: Create tooling
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ToolingCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Resource]
      summary: List toolings
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: toolingType
          in: query
          required: false
          schema: { type: integer }
        - $ref: '#/components/parameters/Keyword'
        - $ref: '#/components/parameters/Status'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/station-groups:
    post:
      tags: [MasterData-Resource]
      summary: Create station group
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/StationGroupCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Resource]
      summary: List station groups
      parameters: [ { $ref: '#/components/parameters/PageNo' }, { $ref: '#/components/parameters/PageSize' }, { $ref: '#/components/parameters/Keyword' }, { $ref: '#/components/parameters/Status' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /md/labor-groups:
    post:
      tags: [MasterData-Resource]
      summary: Create labor group
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LaborGroupCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [MasterData-Resource]
      summary: List labor groups
      parameters: [ { $ref: '#/components/parameters/PageNo' }, { $ref: '#/components/parameters/PageSize' }, { $ref: '#/components/parameters/Keyword' }, { $ref: '#/components/parameters/Status' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Calendar ----------------
  /calendar/days:batch-set:
    post:
      tags: [Calendar]
      summary: Batch set calendar day
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CalendarDayBatchSetRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /calendar/days:
    get:
      tags: [Calendar]
      summary: Query calendar days
      parameters:
        - name: resourceType
          in: query
          required: true
          schema: { type: integer }
        - name: resourceId
          in: query
          required: true
          schema: { type: integer, format: int64 }
        - $ref: '#/components/parameters/FromDate'
        - $ref: '#/components/parameters/ToDate'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /calendar/shifts:set:
    post:
      tags: [Calendar]
      summary: Set shifts for a day
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CalendarShiftSetRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /calendar/shifts:
    get:
      tags: [Calendar]
      summary: Query shifts
      parameters:
        - name: resourceType
          in: query
          required: true
          schema: { type: integer }
        - name: resourceId
          in: query
          required: true
          schema: { type: integer, format: int64 }
        - $ref: '#/components/parameters/FromDate'
        - $ref: '#/components/parameters/ToDate'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /calendar/maintenance-windows:
    post:
      tags: [Calendar]
      summary: Create maintenance window
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/MaintenanceWindowCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [Calendar]
      summary: Query maintenance windows
      parameters:
        - name: resourceType
          in: query
          required: true
          schema: { type: integer }
        - name: resourceId
          in: query
          required: true
          schema: { type: integer, format: int64 }
        - name: fromTime
          in: query
          required: false
          schema: { type: string, format: date-time }
        - name: toTime
          in: query
          required: false
          schema: { type: string, format: date-time }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /calendar/maintenance-windows/{id}:
    patch:
      tags: [Calendar]
      summary: Update maintenance window
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                startTime: { type: string, format: date-time }
                endTime: { type: string, format: date-time }
                reason: { type: string }
                status: { type: integer }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    delete:
      tags: [Calendar]
      summary: Delete maintenance window (soft)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Sales Orders ----------------
  /sales-orders:
    post:
      tags: [SalesOrder]
      summary: Create sales order
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SalesOrderCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [SalesOrder]
      summary: List sales orders
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: modelId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - name: status
          in: query
          required: false
          schema: { type: integer }
        - name: fromDueDate
          in: query
          required: false
          schema: { type: string, format: date }
        - name: toDueDate
          in: query
          required: false
          schema: { type: string, format: date }
        - $ref: '#/components/parameters/Keyword'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /sales-orders/{id}:
    get:
      tags: [SalesOrder]
      summary: Sales order detail
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /sales-orders/{id}/approve:
    post:
      tags: [SalesOrder]
      summary: Approve sales order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /sales-orders/{id}/to-prod:
    post:
      tags: [SalesOrder]
      summary: Convert sales order to prod order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ToProdRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Prod Orders ----------------
  /prod-orders:
    post:
      tags: [ProdOrder]
      summary: Create prod order
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ProdOrderCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [ProdOrder]
      summary: List prod orders
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: status
          in: query
          required: false
          schema: { type: integer }
        - name: orderKind
          in: query
          required: false
          schema: { type: integer }
        - name: fromDueDate
          in: query
          required: false
          schema: { type: string, format: date }
        - name: toDueDate
          in: query
          required: false
          schema: { type: string, format: date }
        - $ref: '#/components/parameters/Keyword'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /prod-orders/{id}:
    get:
      tags: [ProdOrder]
      summary: Prod order detail (with attrs)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    patch:
      tags: [ProdOrder]
      summary: Update prod order (allowed in draft/pending)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                qty: { type: integer }
                dueDate: { type: string, format: date }
                priority: { type: integer }
                remark: { type: string }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /prod-orders/{id}/attrs:set:
    post:
      tags: [ProdOrder]
      summary: Set prod order attrs (color etc.)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ProdOrderAttrsSetRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /prod-orders/{id}/submit-approve:
    post:
      tags: [ProdOrder]
      summary: Submit prod order for approval
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /prod-orders/{id}/approve:
    post:
      tags: [ProdOrder]
      summary: Approve prod order (admin)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /prod-orders/{id}/reject:
    post:
      tags: [ProdOrder]
      summary: Reject prod order (admin)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CommentRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /prod-orders/{id}/cancel:
    post:
      tags: [ProdOrder]
      summary: Cancel prod order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Approve ----------------
  /approve/tasks:
    get:
      tags: [Approve]
      summary: List approve tasks
      parameters:
        - name: status
          in: query
          required: false
          schema: { type: integer }
        - name: objectType
          in: query
          required: false
          schema: { type: string }
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /approve/tasks/{id}/pass:
    post:
      tags: [Approve]
      summary: Pass approve task
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /approve/tasks/{id}/reject:
    post:
      tags: [Approve]
      summary: Reject approve task
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CommentRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- MPS ----------------
  /plans/mps:
    post:
      tags: [Plan-MPS]
      summary: Create MPS
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/MpsCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [Plan-MPS]
      summary: List MPS
      parameters: [ { $ref: '#/components/parameters/PageNo' }, { $ref: '#/components/parameters/PageSize' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /plans/mps/{id}:
    get:
      tags: [Plan-MPS]
      summary: Get MPS detail
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /plans/mps/{id}/submit-approve:
    post:
      tags: [Plan-MPS]
      summary: Submit MPS approve
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /plans/mps/{id}/approve:
    post:
      tags: [Plan-MPS]
      summary: Approve MPS (admin)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /plans/mps/{id}/close:
    post:
      tags: [Plan-MPS]
      summary: Close MPS
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- MRP ----------------
  /plans/mrp:run:
    post:
      tags: [Plan-MRP]
      summary: Run MRP by MPS
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/MrpRunRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /plans/mrp:
    get:
      tags: [Plan-MRP]
      summary: List MRP results
      parameters:
        - name: mpsId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /plans/mrp/{id}:
    get:
      tags: [Plan-MRP]
      summary: MRP detail
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Schedule ----------------
  /schedules/jobs:
    post:
      tags: [Schedule]
      summary: Create schedule job
      parameters:
        - name: Idempotency-Key
          in: header
          required: false
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ScheduleJobCreate' }
      responses:
        '200':
          $ref: '#/components/responses/ApiResponseOK'

  /schedules/jobs/{jobId}/run:
    post:
      tags: [Schedule]
      summary: Run schedule job (async)
      parameters:
        - name: jobId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /schedules/jobs/{jobId}:
    get:
      tags: [Schedule]
      summary: Get schedule job status
      parameters:
        - name: jobId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data: { $ref: '#/components/schemas/ScheduleJobDTO' }

  /schedules/plans:
    get:
      tags: [Schedule]
      summary: List plans by jobId
      parameters:
        - name: jobId
          in: query
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /schedules/plans/{planId}:
    get:
      tags: [Schedule]
      summary: Plan detail (buckets)
      parameters:
        - name: planId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: processType
          in: query
          required: false
          schema: { type: integer }
        - name: fromDate
          in: query
          required: false
          schema: { type: string, format: date }
        - name: toDate
          in: query
          required: false
          schema: { type: string, format: date }
        - name: lineId
          in: query
          required: false
          schema: { type: integer, format: int64 }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /schedules/plans/{planId}/gantt:
    get:
      tags: [Schedule]
      summary: Gantt data for plan
      parameters:
        - name: planId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: processType
          in: query
          required: false
          schema: { type: integer }
        - name: fromDate
          in: query
          required: false
          schema: { type: string, format: date }
        - name: toDate
          in: query
          required: false
          schema: { type: string, format: date }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /schedules/plans/{planId}/conflicts:
    get:
      tags: [Schedule]
      summary: Plan conflicts
      parameters:
        - name: planId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /schedules/plans/{planId}/adjust:
    post:
      tags: [Schedule]
      summary: Adjust plan buckets manually
      parameters:
        - name: planId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PlanAdjustRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /schedules/plans/{planId}/publish:
    post:
      tags: [Schedule]
      summary: Publish plan to work orders
      parameters:
        - name: planId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: Idempotency-Key
          in: header
          required: false
          schema: { type: string }
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PublishPlanRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /schedules/plans/{planId}/void:
    post:
      tags: [Schedule]
      summary: Void plan (admin)
      parameters:
        - name: planId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/VoidPlanRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- WorkOrder ----------------
  /work-orders:
    get:
      tags: [WorkOrder]
      summary: List work orders
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: processType
          in: query
          required: false
          schema: { type: integer }
        - name: lineId
          in: query
          required: false
          schema: { type: integer, format: int64 }
        - name: bizDate
          in: query
          required: false
          schema: { type: string, format: date }
        - name: shiftCode
          in: query
          required: false
          schema: { type: string }
        - name: status
          in: query
          required: false
          schema: { type: integer }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}:
    get:
      tags: [WorkOrder]
      summary: Work order detail
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}/release:
    post:
      tags: [WorkOrder]
      summary: Release work order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WorkOrderActionRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}/start:
    post:
      tags: [WorkOrder]
      summary: Start work order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WorkOrderActionRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}/pause:
    post:
      tags: [WorkOrder]
      summary: Pause work order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WorkOrderActionRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}/resume:
    post:
      tags: [WorkOrder]
      summary: Resume work order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WorkOrderActionRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}/complete:
    post:
      tags: [WorkOrder]
      summary: Complete work order
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WorkOrderActionRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}/void:
    post:
      tags: [WorkOrder]
      summary: Void work order (admin)
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason: { type: string }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /work-orders/{id}/report:
    post:
      tags: [WorkOrder]
      summary: Report work order production
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/WorkOrderReportRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Exception ----------------
  /exceptions:
    post:
      tags: [Exception]
      summary: Create exception
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ExceptionCreate' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
    get:
      tags: [Exception]
      summary: List exceptions
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - name: status
          in: query
          required: false
          schema: { type: integer }
        - name: level
          in: query
          required: false
          schema: { type: integer }
        - name: type
          in: query
          required: false
          schema: { type: string }
        - name: fromTime
          in: query
          required: false
          schema: { type: string, format: date-time }
        - name: toTime
          in: query
          required: false
          schema: { type: string, format: date-time }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /exceptions/{id}:
    get:
      tags: [Exception]
      summary: Exception detail
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /exceptions/{id}/accept:
    post:
      tags: [Exception]
      summary: Accept exception
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /exceptions/{id}/close:
    post:
      tags: [Exception]
      summary: Close exception
      parameters: [ { $ref: '#/components/parameters/IdPath' } ]
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CommentRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- VIN & Trace ----------------
  /vins:batch-create:
    post:
      tags: [VIN-Trace]
      summary: Batch create VINs
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/VinBatchCreateRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /vins:
    get:
      tags: [VIN-Trace]
      summary: List VINs
      parameters:
        - $ref: '#/components/parameters/PageNo'
        - $ref: '#/components/parameters/PageSize'
        - $ref: '#/components/parameters/Keyword'
        - name: status
          in: query
          required: false
          schema: { type: integer }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /vins/{vin}:
    get:
      tags: [VIN-Trace]
      summary: VIN detail
      parameters:
        - name: vin
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /vins/{vin}/events:
    get:
      tags: [VIN-Trace]
      summary: VIN trace events
      parameters:
        - name: vin
          in: path
          required: true
          schema: { type: string }
        - name: fromTime
          in: query
          required: false
          schema: { type: string, format: date-time }
        - name: toTime
          in: query
          required: false
          schema: { type: string, format: date-time }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /vins/{vin}/components:bind:
    post:
      tags: [VIN-Trace]
      summary: Bind component to VIN
      parameters:
        - name: vin
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/VinComponentBindRequest' }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Reports ----------------
  /reports/kpi/overview:
    get:
      tags: [Reports]
      summary: KPI overview
      parameters:
        - name: fromDate
          in: query
          required: true
          schema: { type: string, format: date }
        - name: toDate
          in: query
          required: true
          schema: { type: string, format: date }
        - name: processType
          in: query
          required: false
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf: [ { $ref: '#/components/schemas/ApiResponse' } ]
                properties:
                  data: { $ref: '#/components/schemas/KpiOverviewDTO' }

  /reports/kpi/line-load:
    get:
      tags: [Reports]
      summary: Line load analysis
      parameters:
        - name: fromDate
          in: query
          required: true
          schema: { type: string, format: date }
        - name: toDate
          in: query
          required: true
          schema: { type: string, format: date }
        - name: processType
          in: query
          required: false
          schema: { type: integer }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /reports/kpi/setup:
    get:
      tags: [Reports]
      summary: Setup change analysis
      parameters:
        - name: planId
          in: query
          required: true
          schema: { type: integer, format: int64 }
        - name: processType
          in: query
          required: false
          schema: { type: integer }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /reports/bottleneck:
    get:
      tags: [Reports]
      summary: Bottleneck analysis
      parameters:
        - name: planId
          in: query
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  # ---------------- Open API for external systems ----------------
  /open/erp/sales-orders:push:
    post:
      tags: [OpenAPI]
      summary: ERP push sales orders
      security:
        - accessKeyAuth: []
          signatureAuth: []
          timestampAuth: []
          nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [requestId, items]
              properties:
                requestId: { type: string }
                items:
                  type: array
                  items:
                    type: object
                    required: [salesNo, modelCode, qty, dueDate]
                    properties:
                      salesNo: { type: string }
                      modelCode: { type: string }
                      qty: { type: integer }
                      dueDate: { type: string, format: date }
                      priority: { type: integer, default: 0 }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /open/mes/work-orders:
    get:
      tags: [OpenAPI]
      summary: MES pull work orders
      security:
        - accessKeyAuth: []
          signatureAuth: []
          timestampAuth: []
          nonceAuth: []
      parameters:
        - name: bizDate
          in: query
          required: true
          schema: { type: string, format: date }
        - name: shiftCode
          in: query
          required: true
          schema: { type: string }
        - name: processType
          in: query
          required: true
          schema: { type: integer }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }

  /open/iot/equipments/status:push:
    post:
      tags: [OpenAPI]
      summary: IoT push equipment status
      security:
        - accessKeyAuth: []
          signatureAuth: []
          timestampAuth: []
          nonceAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [requestId, items]
              properties:
                requestId: { type: string }
                items:
                  type: array
                  items:
                    type: object
                    required: [equipCode, healthStatus, eventTime]
                    properties:
                      equipCode: { type: string }
                      healthStatus: { type: integer, description: "0正常1预警2故障" }
                      eventTime: { type: string, format: date-time }
                      payload: { type: object, nullable: true }
      responses:
        '200': { $ref: '#/components/responses/ApiResponseOK' }
```